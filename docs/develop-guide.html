
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cider Developer Guide &#8212; Cider 1.0 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Syntax support in Cider" href="syntax-support.html" />
    <link rel="prev" title="Cider in 10 minutes" href="cider-in-10-min.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="syntax-support.html" title="Syntax support in Cider"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cider-in-10-min.html" title="Cider in 10 minutes"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cider 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cider-developer-guide">
<h1>Cider Developer Guide<a class="headerlink" href="#cider-developer-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-to-build">
<h2>1 How to build<a class="headerlink" href="#how-to-build" title="Permalink to this headline">¶</a></h2>
<div class="section" id="build-bdtk">
<h3>1.1 Build BDTK<a class="headerlink" href="#build-bdtk" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Prerequisite:</strong></div>
<div class="line">Install docker and set proxy according to the guidance in:</div>
<div class="line"><a class="reference external" href="https://docs.docker.com/config/daemon/systemd/">https://docs.docker.com/config/daemon/systemd/</a></div>
<div class="line"><a class="reference external" href="https://docs.docker.com/network/proxy/">https://docs.docker.com/network/proxy/</a></div>
</div>
<ol class="arabic simple">
<li>Get the BDTK Source</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone --recursive https://github.com/intel/BDTK.git
$ cd BDTK
# if you are updating an existing checkout
$ git submodule sync --recursive
$ git submodule update --init --recursive
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p class="first">Setting up BDTK develop envirenmont on Linux Docker</p>
<p>We provide Dockerfile to help developers setup and install BDTK dependencies.</p>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Build an image from a Dockerfile
$ cd ${path_to_source_of_bdtk}/ci/docker
$ docker build -t ${image_name} .

# Start a docker container for development
docker run -d --name ${container_name} --privileged=true -v ${path_to_bdtk}:/workspace/bdtk ${image_name} /usr/sbin/init
# Tips: you can run with more CPU cores to accelerate building time
# docker run -d ... ${image_name} --cpus=&quot;30&quot; /usr/sbin/init

docker exec -it ${container_name} /bin/bash
</pre></div>
</div>
<p><em>Note: files used for building image are from cider and presto,
details are as follows:</em></p>
<ol class="arabic" start="3">
<li><p class="first">Build in container</p>
<p>Once you have setup the Docker build envirenment for BDTK and get the source, you can enter the BDTK container and build like:</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">make</span></code> in the root directory to compile the sources. For development, use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">debug</span></code> to build a non-optimized debug version, or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">release</span></code> to build an optimized version. Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-debug</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-release</span></code> to run tests.</p>
</li>
<li><p class="first">Setup ssh for debugging</p>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start ssh server in the docker</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">ssh</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span> <span class="o">-</span><span class="n">t</span> <span class="n">rsa</span> <span class="c1"># help create .ssh folder</span>
<span class="n">systemctl</span> <span class="n">enable</span> <span class="n">ssh</span>
<span class="c1"># Configure bypass ssh to docker</span>
<span class="c1"># Configure remote debug referring https://www.jianshu.com/p/0f2fb935a9a1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-run-unit-tests">
<h2>2 How to run unit tests<a class="headerlink" href="#how-to-run-unit-tests" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-run-all-unit-tests">
<h3>2.1 How to run all unit tests<a class="headerlink" href="#how-to-run-all-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>For BDTK:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># WORKDIR: /workspace/bdtk</span>
<span class="c1"># test both cider and cider-velox</span>
<span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">release</span>

<span class="c1"># only test cider</span>
<span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">cider</span> <span class="n">BUILD_TYPE</span><span class="o">=</span><span class="n">Debug</span><span class="o">/</span><span class="n">Release</span> <span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">cider</span><span class="o">-</span><span class="n">velox</span>

<span class="c1"># only test cider-velox</span>
<span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">cider</span><span class="o">-</span><span class="n">velox</span> <span class="n">BUILD_TYPE</span><span class="o">=</span><span class="n">Debug</span><span class="o">/</span><span class="n">Release</span>

<span class="c1"># Note: If you want to test both Debug and Release, just use &#39;&amp;&amp;&#39; to connect two commands.</span>
</pre></div>
</div>
<p>2.2 How to run a single unit test</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># For Cider</span>
<span class="c1"># Test Path: /workspace/bdtk/build-$BUILD_TYPE/cider/tests</span>
<span class="o">./</span><span class="n">XXXtest</span>

<span class="c1"># For CiderVelox</span>
<span class="c1"># Test Path: /workspace/bdtk/build-$BUILD_TYPE/cider-velox/tests</span>

<span class="c1"># Please check is there a function directory(auto generate when make test-$BUILD_TYPE) under cider-velox.</span>
<span class="c1"># If not, please use follow commands to get one(under /workspace/bdtk/):</span>
<span class="c1">#   mkdir /workspace/bdtk/build-${BUILD_TYPE}/cider-velox/function</span>
<span class="c1">#   cp /workspace/bdtk/build-${BUILD_TYPE}/cider/function/*.bc /workspace/bdtk/build-{BUILD_TYPE}/cider-velox/function</span>
<span class="c1">#   cd /workspace/bdtk/build-${BUILD_TYPE}cider-velox/test</span>
<span class="o">./</span><span class="n">XXXtest</span>
</pre></div>
</div>
<p>Then configure GDB with the built test binaries, like following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [
    {
      &quot;name&quot;: &quot;${name_of_this_configuration}&quot;,
      &quot;type&quot;: &quot;cppdbg&quot;,
      &quot;request&quot;: &quot;launch&quot;,
      &quot;program&quot;: &quot;${path_to_the_test_you_want_to_debug}&quot;,
      &quot;args&quot;: [],
      &quot;stopAtEntry&quot;: false,
      &quot;cwd&quot;: &quot;${workspaceFolder}&quot;,
      &quot;environment&quot;: [],
      &quot;externalConsole&quot;: false,
      &quot;MIMode&quot;: &quot;gdb&quot;,
      &quot;setupCommands&quot;: [
          {
              &quot;description&quot;: &quot;Enable pretty-printing for gdb&quot;,
              &quot;text&quot;: &quot;-enable-pretty-printing&quot;,
              &quot;ignoreFailures&quot;: true
          }
      ]
    }
    ]
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-install">
<h2>3 How to install<a class="headerlink" href="#how-to-install" title="Permalink to this headline">¶</a></h2>
<p>TODO:</p>
</div>
<div class="section" id="how-to-debug">
<h2>4 How to debug<a class="headerlink" href="#how-to-debug" title="Permalink to this headline">¶</a></h2>
<div class="section" id="debug-cider-in-vscode">
<h3>4.1 Debug cider in vscode<a class="headerlink" href="#debug-cider-in-vscode" title="Permalink to this headline">¶</a></h3>
<p>Enable debug option when make: <code class="docutils literal notranslate"><span class="pre">cmake</span>&#160; <span class="pre">-DCMAKE_BUILD_TYPE=Debug</span> <span class="pre">..</span></code>
Configure <code class="docutils literal notranslate"><span class="pre">.vscode/launch.json</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [
    {
      &quot;name&quot;: &quot;${name_of_this_configuration}&quot;,
      &quot;type&quot;: &quot;cppdbg&quot;,
      &quot;request&quot;: &quot;launch&quot;,
      &quot;program&quot;: &quot;${path_to_the_test_you_want_to_debug}&quot;,
      &quot;args&quot;: [],
      &quot;stopAtEntry&quot;: false,
      &quot;cwd&quot;: &quot;${workspaceFolder}&quot;,
      &quot;environment&quot;: [],
      &quot;externalConsole&quot;: false,
      &quot;MIMode&quot;: &quot;gdb&quot;,
      &quot;setupCommands&quot;: [
          {
              &quot;description&quot;: &quot;Enable pretty-printing for gdb&quot;,
              &quot;text&quot;: &quot;-enable-pretty-printing&quot;,
              &quot;ignoreFailures&quot;: true
          }
      ]
    }
    ]
}
</pre></div>
</div>
<p>Then “Run and debug”</p>
</div>
<div class="section" id="debug-in-clion">
<h3>4.2 Debug in CLion<a class="headerlink" href="#debug-in-clion" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Configure Toolchain</li>
<li>Configure CMake, set build type as <code class="docutils literal notranslate"><span class="pre">Debug</span></code> and build directory to
be “build” <em>Note: you should have already built cider binary under
“build” dir, otherwise, you need configure Clion bundled cmake task
to launch build task.</em></li>
<li>Choose ExecuteTest for example and start debug, set up breakpoints
and step in/over</li>
</ol>
</div>
<div class="section" id="remote-debug-in-docker-image-with-clion">
<h3>4.3 Remote debug in Docker image with Clion<a class="headerlink" href="#remote-debug-in-docker-image-with-clion" title="Permalink to this headline">¶</a></h3>
<p>TODO:</p>
</div>
</div>
<div class="section" id="how-to-get-llvm-ir">
<h2>5 How to get LLVM IR<a class="headerlink" href="#how-to-get-llvm-ir" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="how-to-run-simple-examples-with-prestodb-in-dev-environment">
<h2>6 How to run simple examples with Prestodb in DEV environment<a class="headerlink" href="#how-to-run-simple-examples-with-prestodb-in-dev-environment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configure-hive-metastore">
<h3>6.1 Configure Hive MetaStore<a class="headerlink" href="#configure-hive-metastore" title="Permalink to this headline">¶</a></h3>
<p>Follow the steps from
<a class="reference external" href="https://prestodb.io/docs/current/installation/deployment.html#configuring-presto">https://prestodb.io/docs/current/installation/deployment.html#configuring-presto</a>
to install Hive metastore (requiring HDFS pre-installed)</p>
<p>Download and extract the binary tarball of Hive. For example, download
and untar <code class="docutils literal notranslate"><span class="pre">apache-hive-&lt;VERSION&gt;-bin.tar.gz</span></code></p>
<p>You only need to launch Hive Metastore to serve Presto catalog
information such as table schema and partition location. If it is the
first time to launch the Hive Metastore, prepare corresponding
configuration files and environment, also initialize a new Metastore:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export HIVE_HOME=`pwd`
cp conf/hive-default.xml.template conf/hive-site.xml
mkdir -p hcatalog/var/log/
# only required for the first time
bin/schematool -dbType derby -initSchema
</pre></div>
</div>
<p>Start a Hive Metastore which will run in the background and listen on
port 9083 (by default).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hcatalog</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">hcat_server</span><span class="o">.</span><span class="n">sh</span> <span class="n">start</span>
<span class="c1"># Output:</span>
<span class="c1"># Started metastore server init, testing if initialized correctly...</span>
<span class="c1"># Metastore initialized successfully on port[9083].</span>
</pre></div>
</div>
</div>
<div class="section" id="prepare-cider-as-library">
<h3>6.2 Prepare Cider as library<a class="headerlink" href="#prepare-cider-as-library" title="Permalink to this headline">¶</a></h3>
<div class="section" id="resolve-dependency">
<h4>6.2.2 Resolve dependency<a class="headerlink" href="#resolve-dependency" title="Permalink to this headline">¶</a></h4>
<p>Copy <code class="docutils literal notranslate"><span class="pre">$CIDER_BUILD_DIR/function</span></code> to <code class="docutils literal notranslate"><span class="pre">$JAVA_HOME/</span></code>
may need <code class="docutils literal notranslate"><span class="pre">function/*.bc</span></code> files</p>
</div>
</div>
<div class="section" id="configure-prestodb-server-and-run-some-example-queries">
<h3>6.3 Configure Prestodb server and run some example queries<a class="headerlink" href="#configure-prestodb-server-and-run-some-example-queries" title="Permalink to this headline">¶</a></h3>
<p>Follow steps from
<a class="reference external" href="https://github.com/intel-bigdata/presto/tree/cider#running-presto-in-your-ide">https://github.com/intel-bigdata/presto/tree/cider#running-presto-in-your-ide</a></p>
<div class="section" id="running-with-ide">
<h4>6.3.1 Running with IDE<a class="headerlink" href="#running-with-ide" title="Permalink to this headline">¶</a></h4>
<p>After building Presto for the first time, you can load the project into
your IDE and run the server. We recommend using <a class="reference external" href="http://www.jetbrains.com/idea/">IntelliJ
IDEA</a>. Because Presto is a standard
Maven project, you can import it into your IDE using the root
<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code> file. In IntelliJ, choose Open Project from the Quick Start
box or choose Open from the File menu and select the root <code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>
file.</p>
<p>After opening the project in IntelliJ, double check that the Java SDK is
properly configured for the project: * Open the File menu and select
Project Structure * In the SDKs section, ensure that a 1.8 JDK is
selected (create one if none exist) * In the Project section, ensure
the Project language level is set to 8.0 as Presto makes use of several
Java 8 language features</p>
<p>Presto comes with sample configuration that should work out-of-the-box
for development. Use the following options to create a run
configuration: * Main Class: com.facebook.presto.server.PrestoServer *
VM Options:
<code class="docutils literal notranslate"><span class="pre">-ea</span> <span class="pre">-XX:+UseG1GC</span> <span class="pre">-XX:G1HeapRegionSize=32M</span> <span class="pre">-XX:+UseGCOverheadLimit</span> <span class="pre">-XX:+ExplicitGCInvokesConcurrent</span> <span class="pre">-Xmx2G</span> <span class="pre">-Dconfig=etc/config.properties</span> <span class="pre">-Dlog.levels-file=etc/log.properties</span></code>
* Working directory: <code class="docutils literal notranslate"><span class="pre">$MODULE_DIR$</span></code> * Use classpath of module:
presto-main</p>
<p>The working directory should be the <code class="docutils literal notranslate"><span class="pre">presto-main</span></code> subdirectory. In
IntelliJ, using <code class="docutils literal notranslate"><span class="pre">$MODULE_DIR$</span></code> accomplishes this automatically.
Additionally, the Hive plugin must be configured with location of your
Hive metastore Thrift service. Add the following to the list of VM
options, replacing <code class="docutils literal notranslate"><span class="pre">localhost:9083</span></code> with the correct host and port (or
use the below value if you do not have a Hive metastore):
<code class="docutils literal notranslate"><span class="pre">-Dhive.metastore.uri=thrift://localhost:9083</span></code></p>
</div>
<div class="section" id="how-to-improve-prestodb-initialization-speed">
<h4>6.3.2 How to improve Prestodb initialization speed<a class="headerlink" href="#how-to-improve-prestodb-initialization-speed" title="Permalink to this headline">¶</a></h4>
<p>Speed up presto init Presto server will load a lot plugin and it will
resolve dependency from maven central repo and this is really slow. A
solution is to modify this class and bypass resolve step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">offline</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jikunshang</span><span class="o">/</span><span class="n">resolver</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">resolver</span>
<span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span> <span class="o">-</span><span class="n">DskipTests</span><span class="o">=</span><span class="n">true</span>
<span class="c1"># change resolver version in pom file</span>
<span class="c1"># presto/pom.xml L931    &lt;version&gt;1.4&lt;/version&gt; -&gt;   &lt;version&gt;1.7-SNAPSHOT&lt;/version&gt;</span>
<span class="n">And</span> <span class="n">you</span> <span class="n">can</span> <span class="n">remove</span> <span class="n">unnecessary</span> <span class="n">catlog</span><span class="o">/</span><span class="n">connector</span> <span class="n">by</span> <span class="n">remove</span> <span class="n">source</span><span class="o">/</span><span class="n">presto</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">catalog</span><span class="o">/*.</span><span class="n">properties</span> <span class="ow">and</span> <span class="n">source</span><span class="o">/</span><span class="n">presto</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">catalog</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">properties</span>  <span class="n">plugin</span><span class="o">.</span><span class="n">bundles</span><span class="o">=</span>
</pre></div>
</div>
</div>
<div class="section" id="running-filter-project-queries-with-cli">
<h4>6.3.3 Running filter/project queries with CLI<a class="headerlink" href="#running-filter-project-queries-with-cli" title="Permalink to this headline">¶</a></h4>
<p>Start the CLI to connect to the server and run SQL queries:
<code class="docutils literal notranslate"><span class="pre">presto-cli/target/presto-cli-*-executable.jar</span></code> Run a query to see the
nodes in the cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">system</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">nodes</span><span class="p">;</span>

<span class="n">presto</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">a</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span> <span class="n">double</span><span class="p">,</span> <span class="n">c</span> <span class="nb">int</span><span class="p">)</span> <span class="n">WITH</span> <span class="p">(</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;ORC&#39;</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">test</span> <span class="n">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="nb">set</span> <span class="n">session</span> <span class="n">hive</span><span class="o">.</span><span class="n">pushdown_filter_enabled</span><span class="o">=</span><span class="n">true</span><span class="p">;</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">hive.default.test</span> <span class="n">where</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="running-join-queries-with-cli">
<h4>6.3.4 Running join queries with CLI<a class="headerlink" href="#running-join-queries-with-cli" title="Permalink to this headline">¶</a></h4>
<p>Start the CLI to connect to the server and run SQL queries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">presto</span><span class="o">-</span><span class="n">cli</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">presto</span><span class="o">-</span><span class="n">cli</span><span class="o">-*-</span><span class="n">executable</span><span class="o">.</span><span class="n">jar</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc1</span><span class="p">(</span><span class="n">a</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span> <span class="n">double</span><span class="p">,</span> <span class="n">c</span> <span class="nb">int</span><span class="p">)</span> <span class="n">WITH</span> <span class="p">(</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;ORC&#39;</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc1</span> <span class="n">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">SESSION</span> <span class="n">join_distribution_type</span> <span class="o">=</span> <span class="s1">&#39;PARTITIONED&#39;</span><span class="p">;</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc2</span> <span class="p">(</span><span class="n">a</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span> <span class="n">double</span><span class="p">,</span> <span class="n">c</span> <span class="nb">int</span><span class="p">)</span> <span class="n">WITH</span> <span class="p">(</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;ORC&#39;</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc2</span> <span class="n">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">hive.default.test_orc1</span> <span class="n">l</span><span class="p">,</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc2</span> <span class="n">r</span> <span class="n">where</span> <span class="n">l</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">a</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-run-simple-examples-with-prestodb-in-distributed-environment">
<h2>7 How to run simple examples with Prestodb in distributed environment<a class="headerlink" href="#how-to-run-simple-examples-with-prestodb-in-distributed-environment" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Create a folder to install cider files, for example <code class="docutils literal notranslate"><span class="pre">cider</span></code></p>
</li>
<li><div class="first line-block">
<div class="line">Copy the lib folder under the cider docker build environment to
every node, for example, copy
<code class="docutils literal notranslate"><span class="pre">/usr/local/lib/</span></code> folder to
<code class="docutils literal notranslate"><span class="pre">/path/to/cider</span></code> on every Prestodb node</div>
</div>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cider</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Copy the <code class="docutils literal notranslate"><span class="pre">ExtensionFunctions.ast</span></code>, and
<code class="docutils literal notranslate"><span class="pre">RuntimeFunctions.bc</span></code> from the function folder under the
cider build folder to function folder</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cider</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">function</span><span class="o">/</span><span class="n">ExtensionFunctions</span><span class="o">.</span><span class="n">ast</span>   <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cider</span><span class="o">/</span><span class="n">function</span>
<span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cider</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">function</span><span class="o">/</span><span class="n">RuntimeFunctions</span><span class="o">.</span><span class="n">bc</span>   <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cider</span><span class="o">/</span><span class="n">function</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li>Set the LD_LIBRARY_PATH environment variable include the lib folder.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export LD_LIBRARY_PATH=/path/to/cider/lib:$LD_LIBRARY_PATH
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li>You may also need include the libjvm.so in your LD_LIBRARY_PATH if
it is not</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export LD_LIBRARY_PATH= $JAVA_HOME/jre/lib/amd64/server/:$LD_LIBRARY_PATH
</pre></div>
</div>
</div>
<div class="section" id="how-to-contribute-document">
<h2>8 How to contribute document<a class="headerlink" href="#how-to-contribute-document" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>8.1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>Cider documentation uses sphinx to produce html structure.
Github pages refer to “docs” directory on “gh-pages” branch.</p>
</div>
<div class="section" id="build-and-commit">
<h3>8.2 Build and commit<a class="headerlink" href="#build-and-commit" title="Permalink to this headline">¶</a></h3>
<p>We maintain gh-pages with github actions, which is implemented in .github/workflows/update-gh-pages.yml.</p>
<p>We can simply edit rst files under “docs” directory, when the change merge to “main” branch,
github action will automatically build gh-pages.</p>
<p>If you want to add a new rst file, remember add its title to “index.rst”.</p>
</div>
<div class="section" id="external-links">
<h3>8.3 External links<a class="headerlink" href="#external-links" title="Permalink to this headline">¶</a></h3>
<p>Last, share some tools and documents, hope it can help:</p>
<ol class="arabic simple">
<li>Sphinx quick start: <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/quickstart.html">sphinx-doc</a></li>
<li>How to write rst(reStructuredText) files: <a class="reference external" href="https://www.devdungeon.com/content/restructuredtext-rst-tutorial-0">rst-tutorial</a></li>
<li>Transfer markdown to rst: <a class="reference external" href="https://cloudconvert.com/md-to-rst">md-to-rst</a></li>
</ol>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>9 Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cider-velox-docker-build-failed-issue">
<h3>9.1 Cider Velox docker build failed issue<a class="headerlink" href="#cider-velox-docker-build-failed-issue" title="Permalink to this headline">¶</a></h3>
<div class="section" id="the-rapidjson-build-failed-issue">
<h4>9.1.1 The rapidjson build failed issue<a class="headerlink" href="#the-rapidjson-build-failed-issue" title="Permalink to this headline">¶</a></h4>
<p>error like blow. Fix it by rapidjson/rapidjson/document.h:2244:22: note:
candidate: ’template rapidjson::GenericDocument&lt;Encoding, Allocator,
StackAllocator&gt;&amp; rapidjson::GenericDocument&lt;Encoding, Allocator,
StackAllocator&gt;::Parse(const Ch<em>) [with unsigned int parseFlags =
parseFlags; Encoding = rapidjson::UTF8&lt;&gt;; Allocator =
rapidjson::MemoryPoolAllocator&lt;&gt;; StackAllocator =
rapidjson::CrtAllocator]’ 2244 | GenericDocument&amp; Parse(const Ch</em> str)
{ | ^~~~~</p>
</div>
<div class="section" id="maven-cant-parse-proxy-correctly">
<h4>9.1.2 Maven can’t parse proxy correctly<a class="headerlink" href="#maven-cant-parse-proxy-correctly" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">If it raises error related to proxy by Maven, please ensure your
settings.xml file (usually ${user.home}/.m2/settings.xml) is secured
with permissions appropriate for your operating system.</div>
<div class="line">Reference: <a class="reference external" href="https://maven.apache.org/guides/mini/guide-proxies.html">https://maven.apache.org/guides/mini/guide-proxies.html</a></div>
</div>
</div>
<div class="section" id="the-velox-build-failed-issue">
<h4>9.1.3 The Velox build failed issue<a class="headerlink" href="#the-velox-build-failed-issue" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>If it raises error on the code in velox/velox/core/Context.h,</dt>
<dd>please modified the corresponding code like this:</dd>
</dl>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>enum class ContextScope { GLOBAL, SESSION, QUERY, SCOPESTACK };
saying: expected identifier before ‘,’ token, please make a modification:
enum class UseCase {
DEV = 1,
TEST = 2,
PROD = 3,
};

#ifdef GLOBAL
#undef GLOBAL
#endif
enum class ContextScope { GLOBAL, SESSION, QUERY, SCOPESTACK };
</pre></div>
</div>
</div>
</div>
<div class="section" id="prestodb-internals">
<h3>9.2 Prestodb Internals<a class="headerlink" href="#prestodb-internals" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="code-style-check">
<h2>10 Code Style Check<a class="headerlink" href="#code-style-check" title="Permalink to this headline">¶</a></h2>
<p>Code style check will be triggered automatically after you submit a PR. So please ensure your PR does not break any of these workflows. It runs <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">format-check</span></code>, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">header-check</span></code> as part of our continuous integration.
Pull requests should pass <code class="docutils literal notranslate"><span class="pre">format-check</span></code> and <code class="docutils literal notranslate"><span class="pre">header-check</span></code> without errors before being accepted.</p>
<p>More details can be found at <a class="reference external" href="https://github.com/intel-innersource/frameworks.ai.modular-sql.velox-plugin/blob/40591b915bfee8068749218725f9c95a4704bacd/ci/scripts/run_cpplint.py">ci/scripts/run_cpplint.py</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Cider Developer Guide</a><ul>
<li><a class="reference internal" href="#how-to-build">1 How to build</a><ul>
<li><a class="reference internal" href="#build-bdtk">1.1 Build BDTK</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-run-unit-tests">2 How to run unit tests</a><ul>
<li><a class="reference internal" href="#how-to-run-all-unit-tests">2.1 How to run all unit tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-install">3 How to install</a></li>
<li><a class="reference internal" href="#how-to-debug">4 How to debug</a><ul>
<li><a class="reference internal" href="#debug-cider-in-vscode">4.1 Debug cider in vscode</a></li>
<li><a class="reference internal" href="#debug-in-clion">4.2 Debug in CLion</a></li>
<li><a class="reference internal" href="#remote-debug-in-docker-image-with-clion">4.3 Remote debug in Docker image with Clion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-get-llvm-ir">5 How to get LLVM IR</a></li>
<li><a class="reference internal" href="#how-to-run-simple-examples-with-prestodb-in-dev-environment">6 How to run simple examples with Prestodb in DEV environment</a><ul>
<li><a class="reference internal" href="#configure-hive-metastore">6.1 Configure Hive MetaStore</a></li>
<li><a class="reference internal" href="#prepare-cider-as-library">6.2 Prepare Cider as library</a><ul>
<li><a class="reference internal" href="#resolve-dependency">6.2.2 Resolve dependency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-prestodb-server-and-run-some-example-queries">6.3 Configure Prestodb server and run some example queries</a><ul>
<li><a class="reference internal" href="#running-with-ide">6.3.1 Running with IDE</a></li>
<li><a class="reference internal" href="#how-to-improve-prestodb-initialization-speed">6.3.2 How to improve Prestodb initialization speed</a></li>
<li><a class="reference internal" href="#running-filter-project-queries-with-cli">6.3.3 Running filter/project queries with CLI</a></li>
<li><a class="reference internal" href="#running-join-queries-with-cli">6.3.4 Running join queries with CLI</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-run-simple-examples-with-prestodb-in-distributed-environment">7 How to run simple examples with Prestodb in distributed environment</a></li>
<li><a class="reference internal" href="#how-to-contribute-document">8 How to contribute document</a><ul>
<li><a class="reference internal" href="#introduction">8.1 Introduction</a></li>
<li><a class="reference internal" href="#build-and-commit">8.2 Build and commit</a></li>
<li><a class="reference internal" href="#external-links">8.3 External links</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">9 Troubleshooting</a><ul>
<li><a class="reference internal" href="#cider-velox-docker-build-failed-issue">9.1 Cider Velox docker build failed issue</a><ul>
<li><a class="reference internal" href="#the-rapidjson-build-failed-issue">9.1.1 The rapidjson build failed issue</a></li>
<li><a class="reference internal" href="#maven-cant-parse-proxy-correctly">9.1.2 Maven can’t parse proxy correctly</a></li>
<li><a class="reference internal" href="#the-velox-build-failed-issue">9.1.3 The Velox build failed issue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prestodb-internals">9.2 Prestodb Internals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#code-style-check">10 Code Style Check</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cider-in-10-min.html"
                        title="previous chapter">Cider in 10 minutes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="syntax-support.html"
                        title="next chapter">Syntax support in Cider</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/develop-guide.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="syntax-support.html" title="Syntax support in Cider"
             >next</a> |</li>
        <li class="right" >
          <a href="cider-in-10-min.html" title="Cider in 10 minutes"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cider 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Intel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>