
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CiderAllocator use guide &#8212; Cider 1.0 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Logger" href="logger.html" />
    <link rel="prev" title="Development Specification" href="development-specification.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="logger.html" title="Logger"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="development-specification.html" title="Development Specification"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cider 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ciderallocator-use-guide">
<h1>CiderAllocator use guide<a class="headerlink" href="#ciderallocator-use-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction-to-ciderallocator">
<h2>1 introduction to CiderAllocator<a class="headerlink" href="#introduction-to-ciderallocator" title="Permalink to this headline">¶</a></h2>
<p>We provide the allocation interface in CiderAllocator.h and two default implementations</p>
<div class="section" id="ciderdefaultallocator-provide-the-default-allocate-and-deallocate-function-via-system-library">
<h3>1.1 CiderDefaultAllocator provide the default allocate and deallocate function via system library<a class="headerlink" href="#ciderdefaultallocator-provide-the-default-allocate-and-deallocate-function-via-system-library" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="alignallocator-provide-the-function-to-perform-memory-alignment">
<h3>1.2 AlignAllocator provide the function to perform memory alignment<a class="headerlink" href="#alignallocator-provide-the-function-to-perform-memory-alignment" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="how-to-use">
<h2>2 how to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>user can construct an allocator from upstream memory pool, and then memory allocated will be in the pool.
or use the CiderDefaultAllocator, AlignAllocator if they don’t want to do it,
but this allocator must be present and passed throughout the calling logic
because Only in this way can you know the memory usage during the entire operation for memory managerment</p>
<p>A typical usage in CiderRunTimeModule</p>
<div class="section" id="add-the-member-variables-in-h-file">
<h3>2.1  add the member variables in .h file<a class="headerlink" href="#add-the-member-variables-in-h-file" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;CiderAllocator&gt;</span> <span class="pre">allocator</span></code></dt>
<dd><p class="first">and add it in the constructor:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CiderRuntimeModule</span><span class="p">(</span>
  <span class="n">std</span><span class="p">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CiderCompilationResult</span><span class="o">&gt;</span> <span class="n">ciderCompilationResult</span><span class="p">,</span>
  <span class="n">CiderCompilationOption</span> <span class="n">ciderCompilationOption</span> <span class="o">=</span> <span class="n">CiderCompilationOption</span><span class="p">::</span><span class="n">defaults</span><span class="p">(),</span>
  <span class="n">CiderExecutionOption</span> <span class="n">ciderExecutionOption</span> <span class="o">=</span> <span class="n">CiderExecutionOption</span><span class="p">::</span><span class="n">defaults</span><span class="p">(),</span>
  <span class="n">std</span><span class="p">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CiderAllocator</span><span class="o">&gt;</span> <span class="n">allocator</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CiderDefaultAllocator</span><span class="o">&gt;</span><span class="p">());</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="in-cpp-implementation-class">
<h3>2.2 in .cpp implementation class<a class="headerlink" href="#in-cpp-implementation-class" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CiderRuntimeModule</span><span class="p">::</span><span class="n">CiderRuntimeModule</span><span class="p">(</span>
    <span class="n">std</span><span class="p">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CiderCompilationResult</span><span class="o">&gt;</span> <span class="n">ciderCompilationResult</span><span class="p">,</span>
    <span class="n">CiderCompilationOption</span> <span class="n">ciderCompilationOption</span><span class="p">,</span>
    <span class="n">CiderExecutionOption</span> <span class="n">ciderExecutionOption</span><span class="p">,</span>
    <span class="n">std</span><span class="p">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CiderAllocator</span><span class="o">&gt;</span> <span class="n">allocator</span><span class="p">)</span>
    <span class="p">:</span> <span class="n">ciderCompilationResult_</span><span class="p">(</span><span class="n">ciderCompilationResult</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">ciderCompilationOption_</span><span class="p">(</span><span class="n">ciderCompilationOption</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">ciderExecutionOption_</span><span class="p">(</span><span class="n">ciderExecutionOption</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">allocator_</span><span class="p">(</span><span class="n">allocator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="then-we-can-use-it-in-the-implementation-class-for-memory-allocation-and-release">
<h3>2.3 Then we can use it in the implementation class for memory allocation and release<a class="headerlink" href="#then-we-can-use-it-in-the-implementation-class-for-memory-allocation-and-release" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">int8_t</span><span class="o">**</span> <span class="n">col_buffers</span> <span class="o">=</span> <span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="n">const</span> <span class="n">int8_t</span><span class="o">**&gt;</span><span class="p">(</span><span class="n">allocator_</span><span class="o">-&gt;</span><span class="n">allocate</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">int8_t</span><span class="o">**</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_col_num</span><span class="p">)));</span>
<span class="n">allocator_</span><span class="o">-&gt;</span><span class="n">deallocate</span><span class="p">(</span><span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="n">int8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">col_buffers</span><span class="p">),</span><span class="n">sizeof</span><span class="p">(</span><span class="n">int8_t</span><span class="o">**</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_col_num</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="finally-we-can-pass-a-custom-allocator-when-creating-ciderruntimemodule-or-use-the-default">
<h3>2.4 Finally we can pass a custom allocator when creating CiderRunTimeModule or use the default<a class="headerlink" href="#finally-we-can-pass-a-custom-allocator-when-creating-ciderruntimemodule-or-use-the-default" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">customAllocator</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CustomAllocator</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">cider_runtime_module_</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CiderRuntimeModule</span><span class="o">&gt;</span><span class="p">(</span><span class="n">compile_res_</span><span class="p">,</span> <span class="n">compile_option</span><span class="p">,</span> <span class="n">exe_option</span><span class="p">,</span> <span class="n">customAllocator</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CiderAllocator use guide</a><ul>
<li><a class="reference internal" href="#introduction-to-ciderallocator">1 introduction to CiderAllocator</a><ul>
<li><a class="reference internal" href="#ciderdefaultallocator-provide-the-default-allocate-and-deallocate-function-via-system-library">1.1 CiderDefaultAllocator provide the default allocate and deallocate function via system library</a></li>
<li><a class="reference internal" href="#alignallocator-provide-the-function-to-perform-memory-alignment">1.2 AlignAllocator provide the function to perform memory alignment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">2 how to use</a><ul>
<li><a class="reference internal" href="#add-the-member-variables-in-h-file">2.1  add the member variables in .h file</a></li>
<li><a class="reference internal" href="#in-cpp-implementation-class">2.2 in .cpp implementation class</a></li>
<li><a class="reference internal" href="#then-we-can-use-it-in-the-implementation-class-for-memory-allocation-and-release">2.3 Then we can use it in the implementation class for memory allocation and release</a></li>
<li><a class="reference internal" href="#finally-we-can-pass-a-custom-allocator-when-creating-ciderruntimemodule-or-use-the-default">2.4 Finally we can pass a custom allocator when creating CiderRunTimeModule or use the default</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="development-specification.html"
                        title="previous chapter">Development Specification</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="logger.html"
                        title="next chapter">Logger</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/CiderAllocator-use-guide.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="logger.html" title="Logger"
             >next</a> |</li>
        <li class="right" >
          <a href="development-specification.html" title="Development Specification"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cider 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Intel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>