
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>How to use &#8212; Cider 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Modules" href="modules.html" />
    <link rel="prev" title="User Guide" href="../user.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modules.html" title="Modules"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../user.html" title="User Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Cider 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../user.html" accesskey="U">User Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-use">
<h1>How to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h1>
<p>BDTK mainly acts as a plugin on velox right now, the major way for it to integrate with Presto is to compile with Velox among the Prestissimo project.
In this context and in the following guide, the term <strong>presto_cpp</strong> or <strong>presto native worker</strong> stands for Presto + Velox integrated with BDTK.</p>
<div class="section" id="environment-preparation">
<h2>Environment Preparation<a class="headerlink" href="#environment-preparation" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>Prerequisite:</strong></div>
<div class="line">Install docker and set proxy according to the guidance in:</div>
<div class="line"><a class="reference external" href="https://docs.docker.com/config/daemon/systemd/">https://docs.docker.com/config/daemon/systemd/</a></div>
<div class="line"><a class="reference external" href="https://docs.docker.com/network/proxy/">https://docs.docker.com/network/proxy/</a></div>
</div>
<ol class="arabic simple">
<li>Get the Source</li>
</ol>
<p>Refer to ${path_to_source_of_bdtk}/ci/scripts/build-presto-package.sh</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Clone the Presto source
$ git clone https://github.com/prestodb/presto.git
# Checkout to BDTK branch
$ git checkout -b BDTK ${PRESTO_BDTK_COMMIT_ID}
# apply bdtk patch
$ git apply ${PATCH_NAME}
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Setting up BDTK develop envirenmont on Linux Docker</li>
</ol>
<p>We provide Dockerfile to help developers setup and install BDTK dependencies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Build an image from a Dockerfile
$ cd ${path_to_source_of_bdtk}/ci/docker
$ docker build -t ${image_name} .

# Start a docker container for development
docker run -d --name ${container_name} --privileged=true -v ${path_to_bdtk}:/workspace/bdtk -v ${path_to_presto}:/workspace/presto ${image_name} /usr/sbin/init
# Tips: you can run with more CPU cores to accelerate building time
# docker run -d ... ${image_name} --cpus=&quot;30&quot; /usr/sbin/init

docker exec -it ${container_name} /bin/bash
</pre></div>
</div>
<p><em>Note: files used for building image are from bdtk and presto,
details are as follows:</em></p>
</div>
<div class="section" id="run-with-prestodb">
<h2>Run with Prestodb<a class="headerlink" href="#run-with-prestodb" title="Permalink to this headline">¶</a></h2>
<div class="section" id="integrate-bdtk-with-presto">
<h3>Integrate BDTK with Presto<a class="headerlink" href="#integrate-bdtk-with-presto" title="Permalink to this headline">¶</a></h3>
<p><em>Note: The following steps should be done in the docker container</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ${path-to-presto}/presto-native-execution
# Integrate BDTK with Presto
$ export WORKER_DIR=${path-to-presto}/presto-native-execution
$ bash ${WORKER_DIR}/BDTK/ci/scripts/integrate-presto-bdtk.sh release
</pre></div>
</div>
<p>Now the you can check your executable presto server file in ${WORKER_DIR}/_build/release/presto_cpp/main/presto_server</p>
</div>
<div class="section" id="run-a-end-to-end-hello-world-demo-on-local-file-system">
<h3>Run a end-to-end Hello World demo on local file system<a class="headerlink" href="#run-a-end-to-end-hello-world-demo-on-local-file-system" title="Permalink to this headline">¶</a></h3>
<p><em>Note: The following steps should be done in the docker container</em></p>
<div class="line-block">
<div class="line"><strong>Prerequisite:</strong></div>
<div class="line">Java 8</div>
<div class="line">Maven 3.5.x and later version</div>
</div>
<ol class="arabic simple">
<li>Compile Prestodb</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ${path-to-presto}
$ mvn clean install -DskipTests
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Set up in IntelliJ</li>
</ol>
<p>Download and install IntellliJ You can also use any other IDE however the instructions in this document will only concern IntelliJ.</p>
<ol class="loweralpha simple">
<li>Open IntelliJ and use ‘Open Existing’ to open the presto project: Click File &gt; New &gt; Module From Existing Sources .. &gt; , Then go to presto_cpp/java/presto-native-tests/pom.xml.</li>
<li>Now lets create the configuration for HiveExternalWorkerQueryRunner. We will need three env variables for this purpose, so copy the following below and replace the text in bold with your specific text.<ol class="lowerroman">
<li>Env Variables: PRESTO_SERVER=&lt;YOUR_PATH_TO_PRESTO_SERVER&gt;;DATA_DIR=/Users/&lt;YOUR_USER_NAME&gt;/Desktop;WORKER_COUNT=0</li>
<li>VM Options: -ea -Xmx2G -XX:+ExitOnOutOfMemoryError -Duser.timezone=America/Bahia_Banderas -Dhive.security=legacy</li>
<li>Main class: com.facebook.presto.hive.HiveExternalWorkerQueryRunner</li>
</ol>
</li>
</ol>
<dl class="docutils">
<dt>NOTE:</dt>
<dd><p class="first">HiveExternalWorkerQueryRunner will basically launch a testing presto service using local file system.</p>
<p>WORKER_COUNT is the number of workers to be launched along with the coordinator. In this case we put 0 as we want to externally launch our own CPP worker.</p>
<p class="last">Note discovery URI. Something like <a class="reference external" href="http://127.0.0.1:54557">http://127.0.0.1:54557</a>. Use the last discovery URI in the InteliJ logs</p>
</dd>
</dl>
<p>Upon running this you should see the Presto service log printing in the console.</p>
<p>3. Update presto native worker configuration
The configuration structrue is stricly the same as Presto-java. And you can put the etc directory anywhere you like.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir ${path-to-presto}/presto-native-execution/etc
$ cd etc
$ vim config.properties
</pre></div>
</div>
<p>Add the basic configuration for a presto worker. Use discovery URI from the logs above and update the config.properties.
The config.properties file should be like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">task</span><span class="o">.</span><span class="n">concurrent</span><span class="o">-</span><span class="n">lifespans</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">task</span><span class="o">=</span><span class="mi">32</span>
<span class="n">http</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">7071</span>
<span class="n">task</span><span class="o">.</span><span class="n">max</span><span class="o">-</span><span class="n">drivers</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">task</span><span class="o">=</span><span class="mi">96</span>
<span class="n">discovery</span><span class="o">.</span><span class="n">uri</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">54557</span>
<span class="n">system</span><span class="o">-</span><span class="n">memory</span><span class="o">-</span><span class="n">gb</span><span class="o">=</span><span class="mi">64</span>
<span class="n">presto</span><span class="o">.</span><span class="n">version</span><span class="o">=</span><span class="n">testversion</span>
</pre></div>
</div>
<p>And then you need modify the node.properties</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vim node.properties
</pre></div>
</div>
<p>The node.properties should be like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="mi">3</span><span class="n">ae8d81c</span><span class="o">-</span><span class="mi">97</span><span class="n">b8</span><span class="o">-</span><span class="mi">42</span><span class="n">c4</span><span class="o">-</span><span class="mf">9e49</span><span class="o">-</span><span class="mi">3524</span><span class="n">cfbe5d8b</span>
<span class="n">node</span><span class="o">.</span><span class="n">ip</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
<span class="n">node</span><span class="o">.</span><span class="n">environment</span><span class="o">=</span><span class="n">testing</span>
<span class="n">node</span><span class="o">.</span><span class="n">location</span><span class="o">=</span><span class="n">test</span><span class="o">-</span><span class="n">location</span>
</pre></div>
</div>
<p>Then you need to modify the configuration for a catalog.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir catalog
$ vim hive.properties
</pre></div>
</div>
<p>Note: You don’t have to configure a real hive catalog.
In the HiveExternalWorkerQueryRunner it’ll create a pseudo hive metastore for you.</p>
<p>The hive.properties should be like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connector</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">hive</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Launch presto native worker</li>
</ol>
<p>Go to YOUR_PATH_TO_PRESTO_SERVER:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd ${path-to-presto}/presto-native-execution/_build/release/presto_cpp/main/
# launch the worker
./presto_server --v=1 --logtostderr=1 --etc_dir=${path-to-your-etc-directory}
</pre></div>
</div>
<p>When you see “Announcement succeeded: 202” printed to the console, the presto native worker has successfully connected to the coordinator.</p>
<p>5. Test the queries
You can sent out queries using your existing presto-cli our go to the presto-cli module you just compiled.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ${path-to-presto}/presto-cli/target
$ ./presto-cli-${PRESTO_VERSION}-SNAPSHOT-executable.jar --catalog hive --schema tpch
</pre></div>
</div>
<p>By doing this you can launch an interactive SQL command.
Try Some queries with Prestissimo + BDTK!</p>
</div>
<div class="section" id="run-a-demo-using-hdfs">
<h3>Run a DEMO using HDFS<a class="headerlink" href="#run-a-demo-using-hdfs" title="Permalink to this headline">¶</a></h3>
<p><em>Note: The following steps should be done in the docker container</em>
| <strong>Prerequisite:</strong>
| A real Hadoop cluster with a running Hive metastore service.</p>
<ol class="arabic simple">
<li>Install Kerberos
You can skip this step if you’ve Kerberos installed on your env.
a. Download Kerberos from its website(<a class="reference external" href="http://web.mit.edu/kerberos/dist/">http://web.mit.edu/kerberos/dist/</a>)</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ wget http://web.mit.edu/kerberos/dist/krb5/1.19/krb5-${krb5-version}.tar.gz
$ tar zxvf krb5-${krb5-version}.tar
$ cp ./krb5-${krb5-version}/src/include/krb5/krb5.hin ./krb5-${krb5-version}/src/include/krb5/krb5.h
</pre></div>
</div>
<p>1. Install the libraries for HDFS/S3</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Set temp env variable for adaptors installation
$ export KERBEROS_INCLUDE_DIRS=${path-to-krb}/src/include
$ cd ${path-to-presto}/presto-native-execution/BDTK/ci/scripts
# Run the script to set up for adpators
$ ./setup-adapters.sh
</pre></div>
</div>
<p>2. Add specific flag when compiling presto_cpp</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Make sure you have finished the BDTK integration before continuing
$ cd ${path-to-presto}/presto-native-execution
$ make PRESTO_ENABLE_PARQUET=ON VELOX_ENABLE_HDFS=ON debug
</pre></div>
</div>
<p>3. Launch a distributed Presto serivce
a. Launch your coordinator as normal presto-java server.
You can find out how to launch a presto-java coorinator from here(<a class="reference external" href="https://prestodb.io/docs/current/installation/deployment.html">https://prestodb.io/docs/current/installation/deployment.html</a>)
b. Edit the configuration of presto native worker under your etc directory:
Modify ${path-to-presto-server-etc}/config.properties</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>task.concurrent-lifespans-per-task=32
http-server.http.port=9876
task.max-drivers-per-task=96
discovery.uri=${discovery-uri}
system-memory-gb=64
presto.version=${your-presto-version}
</pre></div>
</div>
<p><em>NOTE: make sure the presto version is the same as your coordinator</em>
Modify ${path-to-presto-server-etc}/config.properties</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>node.id=${your-presto-node-id}
node.ip=${your-presto-node-ip}
node.environment=${your-presto-env}
node.location=test-location
</pre></div>
</div>
<p>Modify ${path-to-presto-server-etc}/catalog/hive.properties</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>connector.name=hive-hadoop2
hive.metastore.uri=thrift://${your-hive-metastore-serivce}
hive.hdfs.host=${your-hdfs-host}
hive.hdfs.port=${your-hdfs-port}
</pre></div>
</div>
<ol class="loweralpha simple" start="3">
<li>launch the presto native worker</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ {path-to-presto}/presto-native-execution/_build/release/presto_cpp/main/presto_server --v=1 --logtostderr=1 --etc_dir=${path-to-your-etc-directory}
</pre></div>
</div>
<p>When you see “Announcement succeeded: 202” printed to the console, the presto native worker has successfully connected to the coordinator.</p>
</div>
<div class="section" id="run-with-released-package">
<h3>Run with released package<a class="headerlink" href="#run-with-released-package" title="Permalink to this headline">¶</a></h3>
<p>From the release note of BDTK: <a class="reference external" href="https://github.com/intel/BDTK/releases">https://github.com/intel/BDTK/releases</a> , you can download the package of presto_server binary file and libraries.
You can directly run presto native worker with them to skip compiling step.</p>
<ol class="arabic simple">
<li>Unzip the package</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ wget https://github.com/intel/BDTK/releases/download/${latest_tag}/bdtk_${latest_version}.tar.gz
$ cd Prestodb
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Prepare configuration files
You need to prepare the basic configuration files as mentioned above.</li>
<li>Launch presto native worker with binary file</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ # add libraries to include path
$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:./lib
$ # launch the server
$ # --v=1 --logtostderr=1 are flags to print log, you can modify it as your wish
$ ./bin/presto_server --v=1 --logtostderr=1 --etc_dir=${path-to-your-etc-directory}
</pre></div>
</div>
<p>When you see “Announcement succeeded: 202” printed to the console, the presto native worker has successfully connected to the coordinator.</p>
</div>
</div>
<div class="section" id="how-to-run-simple-examples-with-prestodb-in-dev-environment">
<h2>How to run simple examples with Prestodb in DEV environment<a class="headerlink" href="#how-to-run-simple-examples-with-prestodb-in-dev-environment" title="Permalink to this headline">¶</a></h2>
<p>Follow the steps from
<a class="reference external" href="https://prestodb.io/docs/current/installation/deployment.html#configuring-presto">https://prestodb.io/docs/current/installation/deployment.html#configuring-presto</a>
to install Hive metastore (requiring HDFS pre-installed)</p>
<p>Download and extract the binary tarball of Hive. For example, download
and untar <code class="docutils literal notranslate"><span class="pre">apache-hive-&lt;VERSION&gt;-bin.tar.gz</span></code></p>
<p>You only need to launch Hive Metastore to serve Presto catalog
information such as table schema and partition location. If it is the
first time to launch the Hive Metastore, prepare corresponding
configuration files and environment, also initialize a new Metastore:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export HIVE_HOME=`pwd`
cp conf/hive-default.xml.template conf/hive-site.xml
mkdir -p hcatalog/var/log/
# only required for the first time
bin/schematool -dbType derby -initSchema
</pre></div>
</div>
<p>Start a Hive Metastore which will run in the background and listen on
port 9083 (by default).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hcatalog</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">hcat_server</span><span class="o">.</span><span class="n">sh</span> <span class="n">start</span>
<span class="c1"># Output:</span>
<span class="c1"># Started metastore server init, testing if initialized correctly...</span>
<span class="c1"># Metastore initialized successfully on port[9083].</span>
</pre></div>
</div>
<p>Resolve dependency, Copy <code class="docutils literal notranslate"><span class="pre">$CIDER_BUILD_DIR/function</span></code> to <code class="docutils literal notranslate"><span class="pre">$JAVA_HOME/</span></code> may need <code class="docutils literal notranslate"><span class="pre">function/*.bc</span></code> files</p>
<p>Follow steps from
<a class="reference external" href="https://github.com/intel-bigdata/presto/tree/cider#running-presto-in-your-ide">https://github.com/intel-bigdata/presto/tree/cider#running-presto-in-your-ide</a></p>
<p><strong>Running with IDE</strong></p>
<p>After building Presto for the first time, you can load the project into
your IDE and run the server. We recommend using <a class="reference external" href="http://www.jetbrains.com/idea/">IntelliJ
IDEA</a>. Because Presto is a standard
Maven project, you can import it into your IDE using the root
<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code> file. In IntelliJ, choose Open Project from the Quick Start
box or choose Open from the File menu and select the root <code class="docutils literal notranslate"><span class="pre">pom.xml</span></code>
file.</p>
<p>After opening the project in IntelliJ, double check that the Java SDK is
properly configured for the project: * Open the File menu and select
Project Structure * In the SDKs section, ensure that a 1.8 JDK is
selected (create one if none exist) * In the Project section, ensure
the Project language level is set to 8.0 as Presto makes use of several
Java 8 language features</p>
<p>Presto comes with sample configuration that should work out-of-the-box
for development. Use the following options to create a run
configuration: * Main Class: com.facebook.presto.server.PrestoServer *
VM Options:
<code class="docutils literal notranslate"><span class="pre">-ea</span> <span class="pre">-XX:+UseG1GC</span> <span class="pre">-XX:G1HeapRegionSize=32M</span> <span class="pre">-XX:+UseGCOverheadLimit</span> <span class="pre">-XX:+ExplicitGCInvokesConcurrent</span> <span class="pre">-Xmx2G</span> <span class="pre">-Dconfig=etc/config.properties</span> <span class="pre">-Dlog.levels-file=etc/log.properties</span></code>
* Working directory: <code class="docutils literal notranslate"><span class="pre">$MODULE_DIR$</span></code> * Use classpath of module:
presto-main</p>
<p>The working directory should be the <code class="docutils literal notranslate"><span class="pre">presto-main</span></code> subdirectory. In
IntelliJ, using <code class="docutils literal notranslate"><span class="pre">$MODULE_DIR$</span></code> accomplishes this automatically.
Additionally, the Hive plugin must be configured with location of your
Hive metastore Thrift service. Add the following to the list of VM
options, replacing <code class="docutils literal notranslate"><span class="pre">localhost:9083</span></code> with the correct host and port (or
use the below value if you do not have a Hive metastore):
<code class="docutils literal notranslate"><span class="pre">-Dhive.metastore.uri=thrift://localhost:9083</span></code></p>
<p><strong>How to improve Prestodb initialization speed</strong></p>
<p>Speed up presto init Presto server will load a lot plugin and it will
resolve dependency from maven central repo and this is really slow. A
solution is to modify this class and bypass resolve step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">offline</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jikunshang</span><span class="o">/</span><span class="n">resolver</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">resolver</span>
<span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span> <span class="o">-</span><span class="n">DskipTests</span><span class="o">=</span><span class="n">true</span>
<span class="c1"># change resolver version in pom file</span>
<span class="c1"># presto/pom.xml L931    &lt;version&gt;1.4&lt;/version&gt; -&gt;   &lt;version&gt;1.7-SNAPSHOT&lt;/version&gt;</span>
<span class="n">And</span> <span class="n">you</span> <span class="n">can</span> <span class="n">remove</span> <span class="n">unnecessary</span> <span class="n">catlog</span><span class="o">/</span><span class="n">connector</span> <span class="n">by</span> <span class="n">remove</span> <span class="n">source</span><span class="o">/</span><span class="n">presto</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">catalog</span><span class="o">/*.</span><span class="n">properties</span> <span class="ow">and</span> <span class="n">source</span><span class="o">/</span><span class="n">presto</span><span class="o">-</span><span class="n">main</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">catalog</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">properties</span>  <span class="n">plugin</span><span class="o">.</span><span class="n">bundles</span><span class="o">=</span>
</pre></div>
</div>
<p><strong>Running filter/project queries with CLI</strong></p>
<p>Start the CLI to connect to the server and run SQL queries:
<code class="docutils literal notranslate"><span class="pre">presto-cli/target/presto-cli-*-executable.jar</span></code> Run a query to see the
nodes in the cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">system</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">nodes</span><span class="p">;</span>

<span class="n">presto</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">a</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span> <span class="n">double</span><span class="p">,</span> <span class="n">c</span> <span class="nb">int</span><span class="p">)</span> <span class="n">WITH</span> <span class="p">(</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;ORC&#39;</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">test</span> <span class="n">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="nb">set</span> <span class="n">session</span> <span class="n">hive</span><span class="o">.</span><span class="n">pushdown_filter_enabled</span><span class="o">=</span><span class="n">true</span><span class="p">;</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">hive.default.test</span> <span class="n">where</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Running join queries with CLI</strong></p>
<p>Start the CLI to connect to the server and run SQL queries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">presto</span><span class="o">-</span><span class="n">cli</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">presto</span><span class="o">-</span><span class="n">cli</span><span class="o">-*-</span><span class="n">executable</span><span class="o">.</span><span class="n">jar</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc1</span><span class="p">(</span><span class="n">a</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span> <span class="n">double</span><span class="p">,</span> <span class="n">c</span> <span class="nb">int</span><span class="p">)</span> <span class="n">WITH</span> <span class="p">(</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;ORC&#39;</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc1</span> <span class="n">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">SESSION</span> <span class="n">join_distribution_type</span> <span class="o">=</span> <span class="s1">&#39;PARTITIONED&#39;</span><span class="p">;</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc2</span> <span class="p">(</span><span class="n">a</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span> <span class="n">double</span><span class="p">,</span> <span class="n">c</span> <span class="nb">int</span><span class="p">)</span> <span class="n">WITH</span> <span class="p">(</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;ORC&#39;</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc2</span> <span class="n">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="n">presto</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">hive.default.test_orc1</span> <span class="n">l</span><span class="p">,</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">test_orc2</span> <span class="n">r</span> <span class="n">where</span> <span class="n">l</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">a</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-run-simple-examples-with-prestodb-in-distributed-environment">
<h2>How to run simple examples with Prestodb in distributed environment<a class="headerlink" href="#how-to-run-simple-examples-with-prestodb-in-distributed-environment" title="Permalink to this headline">¶</a></h2>
<p>Copy ci/build-presto-package.sh to an empty folder and run it.
Generate Prestodb.tar.gz archive</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">zxvf</span> <span class="n">Prestodb</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">cd</span> <span class="n">Prestodb</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export LD_LIBRARY_PATH=./lib:$LD_LIBRARY_PATH
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">presto_server</span> <span class="o">-</span><span class="n">etc_dir</span><span class="o">=./</span><span class="n">etc</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-settings">
<h2>Advanced Settings<a class="headerlink" href="#advanced-settings" title="Permalink to this headline">¶</a></h2>
<p>There have four pattern configurations now in our project:</p>
<ul class="simple">
<li>LeftDeepJoinPattern</li>
<li>CompoundPattern</li>
<li>FilterPattern</li>
<li>PartialAggPattern</li>
</ul>
<p>We enable <code class="docutils literal notranslate"><span class="pre">CompoundPattern</span></code> and <code class="docutils literal notranslate"><span class="pre">FilterPattern</span></code> by default.</p>
<p>If you want to change the default value of these patterns, there have two ways.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Write a file firstly, such as pattern.flags.</dt>
<dd><div class="first highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">PartialAggPattern</span>
<span class="o">--</span><span class="n">CompoundPattern</span><span class="o">=</span><span class="n">false</span>
</pre></div>
</div>
<p>And then you could use it like this:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">presto_server</span> <span class="o">--</span><span class="n">flagfile</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">pattern</span><span class="o">.</span><span class="n">flags</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Just change them on command line.</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">presto_server</span> <span class="o">--</span><span class="n">PartialAggPattern</span> <span class="o">--</span><span class="n">CompoundPattern</span><span class="o">=</span><span class="n">false</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
<p><em>Note: You also can find the definition of them from file CiderPlanTransformerOptions.cpp.</em></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How to use</a><ul>
<li><a class="reference internal" href="#environment-preparation">Environment Preparation</a></li>
<li><a class="reference internal" href="#run-with-prestodb">Run with Prestodb</a><ul>
<li><a class="reference internal" href="#integrate-bdtk-with-presto">Integrate BDTK with Presto</a></li>
<li><a class="reference internal" href="#run-a-end-to-end-hello-world-demo-on-local-file-system">Run a end-to-end Hello World demo on local file system</a></li>
<li><a class="reference internal" href="#run-a-demo-using-hdfs">Run a DEMO using HDFS</a></li>
<li><a class="reference internal" href="#run-with-released-package">Run with released package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-run-simple-examples-with-prestodb-in-dev-environment">How to run simple examples with Prestodb in DEV environment</a></li>
<li><a class="reference internal" href="#how-to-run-simple-examples-with-prestodb-in-distributed-environment">How to run simple examples with Prestodb in distributed environment</a></li>
<li><a class="reference internal" href="#advanced-settings">Advanced Settings</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../user.html"
                        title="previous chapter">User Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="modules.html"
                        title="next chapter">Modules</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/quick-start.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modules.html" title="Modules"
             >next</a> |</li>
        <li class="right" >
          <a href="../user.html" title="User Guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Cider 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../user.html" >User Guide</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Intel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>